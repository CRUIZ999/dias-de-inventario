<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Panel de Inventario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app-shell">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="status-dot"></div>
        <div>
          <h1 class="app-title">Panel de Inventario</h1>
          <p class="app-subtitle">Archivo CSV delimitado por comas</p>
        </div>
      </div>

      <div class="topbar-right">
        <button id="exportCsvButton" class="btn ghost">Descargar CSV filtrado</button>
        <label class="btn primary">
          <span>↑ Subir CSV</span>
          <input id="fileInput" type="file" accept=".csv" hidden />
        </label>
      </div>
    </header>

    <main class="layout">
      <!-- SIDEBAR FILTROS -->
      <aside class="sidebar">
        <section class="panel">
          <h2 class="panel-title">Filtros</h2>

          <label class="field-label">Buscar</label>
          <div class="field">
            <input
              id="searchInput"
              type="text"
              placeholder="Código, clave o descripción…"
            />
          </div>

          <label class="field-label">Cobertura (Mes)</label>
          <div class="field">
            <select id="coberturaSelect">
              <option value="all">Todas</option>
              <option value="critico">Crítico (0 – 1)</option>
              <option value="medio">Medio (1 – 3)</option>
              <option value="alto">Alto (&gt; 3)</option>
            </select>
          </div>

          <div class="field field-checkbox">
            <label>
              <input type="checkbox" id="onlyCriticalDays" />
              <span>Solo cobertura ≤ 30 días</span>
            </label>
          </div>

          <div class="field field-checkbox">
            <label>
              <input type="checkbox" id="onlyNoMovement" />
              <span>Solo sin movimiento (Prom. Vta Mes = 0)</span>
            </label>
          </div>

          <button id="clearFiltersBtn" class="btn full ghost">Limpiar filtros</button>
        </section>

        <section class="panel">
          <h2 class="panel-title">Estado del archivo</h2>
          <p id="fileStatus" class="file-status">
            Aún no se ha cargado ningún CSV.
          </p>
        </section>

        <section class="panel">
          <div class="field field-checkbox">
            <label>
              <input type="checkbox" id="limitRowsToggle" checked />
              <span>Limitar a 1,000 filas mostradas (más rápido)</span>
            </label>
          </div>
          <p class="hint">
            El filtrado siempre se hace sobre todas las filas, pero se pintan menos
            en la tabla para que el buscador vaya más rápido.
          </p>
        </section>
      </aside>

      <!-- MAIN CONTENT -->
      <section class="main">
        <!-- KPIs -->
        <section class="kpi-grid">
          <article class="kpi-card">
            <h3>Productos</h3>
            <p id="kpiProductos" class="kpi-value">–</p>
            <p class="kpi-caption">Filtrados / Totales</p>
          </article>

          <article class="kpi-card">
            <h3>Inventario total</h3>
            <p id="kpiInventario" class="kpi-value">–</p>
            <p class="kpi-caption">Suma de Inv</p>
          </article>

          <article class="kpi-card">
            <h3>Prom. venta mensual</h3>
            <p id="kpiPromedioVenta" class="kpi-value">–</p>
            <p class="kpi-caption">Suma Promedio Vta Mes</p>
          </article>

          <article class="kpi-card">
            <h3>Cobertura promedio</h3>
            <p id="kpiCobertura" class="kpi-value">–</p>
            <p class="kpi-caption">Días (30)</p>
          </article>
        </section>

        <!-- KPIs secundarios -->
        <section class="kpi-grid kpi-grid-secondary">
          <article class="kpi-card kpi-small">
            <h3>Productos ≤ 30 días</h3>
            <p id="kpiCriticos30" class="kpi-value">–</p>
            <p class="kpi-caption">Cobertura Días (30) ≤ 30</p>
          </article>

          <article class="kpi-card kpi-small">
            <h3>SKUs con inventario &gt; 3 meses</h3>
            <p id="kpiMayor3Meses" class="kpi-value">–</p>
            <p class="kpi-caption">Cobertura (Mes) &gt; 3</p>
          </article>

          <article class="kpi-card kpi-small">
            <h3>% sobre inventario</h3>
            <p id="kpiPctCriticos" class="kpi-value">–</p>
            <p class="kpi-caption">Inv de productos ≤ 30 días</p>
          </article>
        </section>

        <!-- TABLA -->
        <section class="panel panel-table">
          <div class="panel-header">
            <div>
              <h2>Detalle de productos</h2>
              <p class="panel-subtitle">
                Da clic en los encabezados para ordenar (A–Z / Z–A o mayor–menor).
              </p>
            </div>
            <div class="rows-info" id="rowsInfo">0 registros</div>
          </div>

          <div class="table-wrapper">
            <table id="dataTable">
              <thead>
                <tr>
                  <th data-key="codigo">Código</th>
                  <th data-key="clave">Clave</th>
                  <th data-key="desc_prod">Descripción</th>
                  <th data-key="inv" class="is-numeric">Inv</th>
                  <th data-key="clasificacion">Clasificación</th>
                  <th data-key="promedio_vta_mes" class="is-numeric">
                    Promedio Vta Mes
                  </th>
                  <th data-key="cobertura_mes" class="is-numeric">
                    Cobertura (Mes)
                  </th>
                  <th data-key="cobertura_dias_30" class="is-numeric">
                    Cobertura Días (30)
                  </th>
                </tr>
              </thead>
              <tbody>
                <!-- filas dinámicas -->
              </tbody>
            </table>
          </div>
        </section>

        <footer class="footer">
          Ferretería El Cedro · Panel ligero para análisis de CSV · Front-end
          estático sobre GitHub Pages
        </footer>
      </section>
    </main>
  </div>

  <script src="app.js"></script>
</body>
</html>
